%%%% set the listings package to paste the source code
%% easy to paste source code, some code highlighting function
\usepackage{listings}
\usepackage{color}

\DeclareCaptionFont{red}{\color{red}}

%% The programming language in which to paste the code
\lstloadlanguages{{[LaTeX]TeX}, {[ISO]C++}, {Java}, {Ruby}, {Python}, {Scala}}

%% set some global styles for the listings package
%% Reference http://hi.baidu.com/shawpinlee/blog/item/9ec431cbae28e41cbe09e6e4.html
\lstset{
  numberbychapter=true,
  breakatwhitespace=true,
  showstringspaces=false, %% Set whether to display the space symbol between the codes
  basicstyle=\footnotesize\ttfamily, %% set font size\tiny, \scriptsize, \footnotesize, \small, \Large, etc.
  keywordstyle=\bfseries,
  commentstyle=\color{red!50!green!50!blue!50},                           
  escapechar=`, %% Chinese escape characters for Chinese and English mixed
  xleftmargin=1.5em,xrightmargin=0em, aboveskip=1em,
  breaklines, %% This command allows LaTeX to automatically typeset long lines of code
  extendedchars=false, %% This command can solve the problem that the Chinese characters of chapter titles, headers, etc. are not displayed when the code is spread across   pages.
  frameround=fttt,
  captionpos=top,
  belowcaptionskip=1em
}

\lstdefinestyle{numbers}{
   numbers=left,
   numberstyle=\tiny,
   stepnumber=1,
   numbersep=1em
}

\lstdefinestyle{C++}{
   language=C++,
   texcl=true,
   prebreak=\textbackslash,
   breakindent=1em,
   keywordstyle=\bfseries, %% keyword highlighting
   morekeywords={alignas, alignof, char16_t, char32_t, constexpr, decltype, noexcept, nullptr, static_assert, thread_local, override, OVERRIDE, INTERFACE, ABSTRACT, DEFINE_ROLE, ROLE, HAS_ROLE, USE_ROLE}
   style=numbers,
   %frame=leftline, %% to frame the code
   %framerule=2pt,
   %rulesep=5pt
}

\lstnewenvironment{c++}[1][]
  {\setstretch{1}
  \lstset{style=C++, #1}}
  {}

% \ Captionsetup [lstlisting] {text font = red}
%{labelfont=bf, singlelinecheck=off, labelsep=space, textfont=red}

\lstdefinestyle{Java}{
   language=Java,
   texcl=true,
   prebreak=\textbackslash,
   breakindent=1em,
   keywordstyle=\bfseries, %% keyword highlighting
   morekeywords={}
   style=numbers,
   %frame=leftline, %% to frame the code
   %framerule=2pt,
   %rulesep=5pt
}

\lstnewenvironment{java}[1][]
  {\setstretch{1}
  \lstset{style=Java, #1}}
  {}

\lstdefinestyle{Ruby}{
   language=Java,
   texcl=true,
   prebreak=\textbackslash,
   breakindent=1em,
   keywordstyle=\bfseries, %% keyword highlighting
   morekeywords={}
   style=numbers,
   %frame=leftline, %% to frame the code
   %framerule=2pt,
   %rulesep=5pt
}

\lstnewenvironment{ruby}[1][]
  {\setstretch{1}
  \lstset{style=Ruby, #1}}
  {}

\lstdefinestyle{Python}{
   language=Python,
   texcl=true,
   prebreak=\textbackslash,
   breakindent=1em,
   keywordstyle=\bfseries, %% keyword highlighting
   morekeywords={}
   style=numbers,
   %frame=leftline, %% to frame the code
   %framerule=2pt,
   %rulesep=5pt
}

\lstnewenvironment{python}[1][]
  {\setstretch{1}
  \lstset{style=Python, #1}}
  {}

\lstdefinestyle{Scala}{
   language=Scala,
   texcl=true,
   prebreak=\textbackslash,
   breakindent=1em,
   keywordstyle=\bfseries, %% keyword highlighting
   morekeywords={}
   style=numbers,
   %frame=leftline, %% to frame the code
   %framerule=2pt,
   %rulesep=5pt
}

\lstnewenvironment{scala}[1][]
  {\setstretch{1}
  \lstset{style=Scala, #1}}
  {} 

\renewcommand{\lstlistingname}{sample code}
\renewcommand\thefigure{\thechapter-\arabic{figure}}

\newcommand\refcode[1]{{\itshape \lstlistingname\ascii{\ref{code:#1}page \pageref{code:#1}}}}